<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bernardo Freire">
<meta name="dcterms.date" content="2023-08-19">

<title>Bernardo Cruz - FastAPI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Bernardo Cruz - FastAPI">
<meta property="og:description" content="Did you ever dream to build your own fast API written in Python?">
<meta property="og:site-name" content="Bernardo Cruz">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Bernardo Cruz</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html">
 <span class="menu-text">CV</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#database" id="toc-database" class="nav-link" data-scroll-target="#database">Database</a></li>
  <li><a href="#building-our-api" id="toc-building-our-api" class="nav-link" data-scroll-target="#building-our-api">Building our API</a>
  <ul class="collapse">
  <li><a href="#setting-up-the-project" id="toc-setting-up-the-project" class="nav-link" data-scroll-target="#setting-up-the-project">Setting Up the Project</a></li>
  <li><a href="#fastapi-object" id="toc-fastapi-object" class="nav-link" data-scroll-target="#fastapi-object">FastAPI Object</a></li>
  <li><a href="#defining-the-data-model" id="toc-defining-the-data-model" class="nav-link" data-scroll-target="#defining-the-data-model">Defining the Data Model</a></li>
  <li><a href="#building-api-endpoints" id="toc-building-api-endpoints" class="nav-link" data-scroll-target="#building-api-endpoints">Building API Endpoints</a></li>
  <li><a href="#error-handling" id="toc-error-handling" class="nav-link" data-scroll-target="#error-handling">Error Handling</a></li>
  </ul></li>
  <li><a href="#api-documentation" id="toc-api-documentation" class="nav-link" data-scroll-target="#api-documentation">API-Documentation</a>
  <ul class="collapse">
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  <li><a href="#appendix-complete-code" id="toc-appendix-complete-code" class="nav-link" data-scroll-target="#appendix-complete-code">Appendix: Complete code</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">FastAPI</h1>
  <div class="quarto-categories">
    <div class="quarto-category">API Development</div>
    <div class="quarto-category">FastAPI</div>
    <div class="quarto-category">Python</div>
    <div class="quarto-category">SQL</div>
    <div class="quarto-category">CRUD Operations</div>
    <div class="quarto-category">SQLAlchemy</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bernardo Freire </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 19, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Did you ever dream to build your own fast API written in Python?</p>
<p><a href="https://fastapi.tiangolo.com/">FastAPI</a> is a modern, high-performance web framework for building APIs with Python. It blends the ease of use of Python with exceptional speed, making it an ideal choice for developing robust and efficient web applications. Whether you’re crafting a simple REST API or a complex microservices architecture, FastAPI will help you with that.</p>
<p>The installation of FastAPI is very simple and it involves the installation of two packages: (1) FastAPI and (2) Uvicorn. The first one is the framework itself and the second one is the server that will run the API.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">pip</span> install fastapi</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="ex">pip</span> install <span class="st">"uvicorn[standard]"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this tutorial, we will build a simple API that will allow us to perform basic CRUD (Create, Read, Update, Delete) operations on a database. The access to the database will be done by SQLAlchemy, which is a Python SQL toolkit for SQL databases. By the means of fastAPI, we will also provide a documentation of the API, which will be accessible through a web browser.</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>In this post we are going to talk about taxes. More specifically, we will focus on the tax system of Switzerland. Switzerland’s unique tax system is characterized by its federal structure, granting significant fiscal autonomy to its municipalities (cities) and cantons (states). This system encourages competition among cantons and municipalities while also fostering a sense of local ownership and control over financial matters. As a result, Switzerland’s tax landscape is complex, diverse, and reflective of the nation’s commitment to decentralized governance.</p>
<div class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<p>We have data from 201 municipalities during the period between 1990-2022. The data presents the mean wealth per municipality and year.</p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div id="fig-income_tax_zurich" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="api_files/figure-html/fig-income_tax_zurich-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Average wealth of the canton of Zurich per year. A positive trend can be observed for the given time period between 1990 and 2022.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-income_tax_zurich">Figure&nbsp;1</a> shows a positive trend of average wealth in the canton of Zurich per year. The mean value constantly increased from 1990 to 2022. It is quite impressive that the average value is more than doubled in 32 years (considering very low inflation in Switzerland).</p>
</section>
<section id="database" class="level1">
<h1>Database</h1>
<p>The data is stored in a database, a crucial endeavor that lays the foundation for simulating a dynamic production environment. We are going to use <code>sqlalchemy</code>: a remarkable tool empowers us to seamlessly alter the connection string enabling effortlessly establishment of connections across a diverse database types.</p>
<p>First, the connection is defined by <code>sqlalchemy.create_engine()</code> and subsequently used in order to save the data to the database using pandas method <code>to_sql()</code>.</p>
<div id="lst-database" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Create a connection to the database</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>engine <span class="op">=</span> create_engine(              </span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="co">## Path to database                     </span></span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="st">'sqlite:///../../data/FastAPI.db'</span>,      <span class="co">#&nbsp;&lt;1&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>)</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">## Create a table in new database</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>(</span>
<span id="cb2-12"><a href="#cb2-12"></a>    df</span>
<span id="cb2-13"><a href="#cb2-13"></a>    [[<span class="st">'Municipality'</span>,<span class="st">'Year'</span>,<span class="st">'Tax'</span>]]</span>
<span id="cb2-14"><a href="#cb2-14"></a>    .to_sql(</span>
<span id="cb2-15"><a href="#cb2-15"></a>        name <span class="op">=</span> <span class="st">'fastapi'</span>,</span>
<span id="cb2-16"><a href="#cb2-16"></a>        con <span class="op">=</span> engine,</span>
<span id="cb2-17"><a href="#cb2-17"></a>        if_exists <span class="op">=</span> <span class="st">'replace'</span>,</span>
<span id="cb2-18"><a href="#cb2-18"></a>        index <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb2-19"><a href="#cb2-19"></a>    )</span>
<span id="cb2-20"><a href="#cb2-20"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After the creation of the <code>fastapi</code> table within the <code>FastAPI</code> database, we can continue with the creation of the API.</p>
</section>
<section id="building-our-api" class="level1">
<h1>Building our API</h1>
<p>The building blocks of our API-service consists of basic CRUD (Create, Read, Update, Delete) operations as follows:</p>
<table class="table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>Function (api endpoints)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Get Data for a Given Year</td>
<td>Returns wealth tax data for a given year.</td>
</tr>
<tr class="even">
<td>Get Data for a Given Municipality</td>
<td>Returns wealth tax data for a given municipality.</td>
</tr>
<tr class="odd">
<td>Get Data for a Given District</td>
<td>Returns wealth tax data for a given district.</td>
</tr>
<tr class="even">
<td>Get Data for the Canton</td>
<td>Returns wealth tax data for the entire canton.</td>
</tr>
<tr class="odd">
<td>Create New Entry</td>
<td>Creates a new entry in the wealth tax table.</td>
</tr>
<tr class="even">
<td>Update Tax Entry</td>
<td>Updates the wealth tax value for a given municipality and year.</td>
</tr>
<tr class="odd">
<td>Update Year Entry</td>
<td>Updates the year value for a given municipality and year.</td>
</tr>
<tr class="even">
<td>Delete Entry</td>
<td>Deletes an entry from the wealth tax table.</td>
</tr>
</tbody>
</table>
<p>Our api-service is going to use no authentication for its endpoints. This is not recommended for production environments. However, it is a good starting point for learning purposes.</p>
<p>Next, we are going to discuss and review portions of the code that are relevant for the creation of the API. The complete code can be found in the end of the article.</p>
<p><strong>Note:</strong> An API endpoint serves as a specific URL or URI through which an application can interact with a particular functionality or resource on a server. It acts as a gateway, allowing clients to send requests for data or perform actions, while the server processes these requests and sends back the appropriate response. Here’s an example of an API endpoint for a hypothetical online bookstore:</p>
<blockquote class="blockquote">
<p>API Base URL: https://api.bookstore.com</p>
</blockquote>
<p>Example Endpoints:</p>
<blockquote class="blockquote">
<p>Action: Retrieve Book Information Endpoint: /books/{book_id}<br>
Description: Retrieves detailed information about a specific book.<br>
Example URL: https://api.bookstore.com/books/123</p>
</blockquote>
<section id="setting-up-the-project" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-project">Setting Up the Project</h2>
<p>To begin, we import the necessary libraries including <code>pandas</code>, <code>pydantic</code>, and <code>fastapi</code>. We’re also using <code>sqlalchemy</code> for database interactions. Our code starts by creating a database connection using the SQLAlchemy library. We’ve chosen an SQLite database for this demonstration. However, you can use any database you like.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, HTTPException, </span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine, MetaData, Table, select, insert, update, delete</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">## Create a metadata object</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>metadata <span class="op">=</span> MetaData()</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">## Create a connection to the database</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>engine <span class="op">=</span> create_engine(              </span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="co">## Path to database                     </span></span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="st">'sqlite:///../../data/FastAPI.db'</span>,      <span class="co">#&nbsp;&lt;1&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>)</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">## Reflect census table from the engine: census</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>fastapi <span class="op">=</span> Table(</span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="st">"fastapi"</span>, </span>
<span id="cb3-20"><a href="#cb3-20"></a>    metadata,</span>
<span id="cb3-21"><a href="#cb3-21"></a>    autoload_with <span class="op">=</span> engine,</span>
<span id="cb3-22"><a href="#cb3-22"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Moreover, we create a utility function to connect to the database and return a json-style format. This function will be used in the endpoints to fetch data from the database and return the dictionary, which will be converted to json format by FastAPI.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## Helper function to fetch data</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">def</span> fetch_return_dict(</span>
<span id="cb4-3"><a href="#cb4-3"></a>        stmt, </span>
<span id="cb4-4"><a href="#cb4-4"></a>        engine <span class="op">=</span> engine,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    ) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="co">"""</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">    Utility function to convert sql query results to dict via pandas dataframe</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">    """</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="co">## Create a connection to the database</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>    connection <span class="op">=</span> engine.connection()</span>
<span id="cb4-11"><a href="#cb4-11"></a>    data <span class="op">=</span> connection.execute(stmt).fetchall()</span>
<span id="cb4-12"><a href="#cb4-12"></a>    connection.close()</span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="cf">return</span> (</span>
<span id="cb4-15"><a href="#cb4-15"></a>        pd.DataFrame(</span>
<span id="cb4-16"><a href="#cb4-16"></a>            data <span class="op">=</span> data</span>
<span id="cb4-17"><a href="#cb4-17"></a>        )</span>
<span id="cb4-18"><a href="#cb4-18"></a>        .to_dict(</span>
<span id="cb4-19"><a href="#cb4-19"></a>            orient <span class="op">=</span> <span class="st">"records"</span>, </span>
<span id="cb4-20"><a href="#cb4-20"></a>        )</span>
<span id="cb4-21"><a href="#cb4-21"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fastapi-object" class="level2">
<h2 class="anchored" data-anchor-id="fastapi-object">FastAPI Object</h2>
<p>We instantiate a FastAPI app object with a title, description, and version. This app will serve as the backbone of our API. The description section contains details about the API and apear in the documentation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">## Instantiate a FastAPI object</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>app <span class="op">=</span> FastAPI(</span>
<span id="cb5-3"><a href="#cb5-3"></a>    title           <span class="op">=</span>   <span class="st">"API Service"</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    description     <span class="op">=</span>   <span class="st">"""</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">    ...</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="st">    Add more description here</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="st">    ...</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="st">    """</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>    version         <span class="op">=</span>   <span class="st">"0.0.1"</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="defining-the-data-model" class="level2">
<h2 class="anchored" data-anchor-id="defining-the-data-model">Defining the Data Model</h2>
<p>FastAPI encourages the use of <a href="https://docs.pydantic.dev/latest/">Pydantic</a> models for data validation and serialization. Pydantic is a Python library that simplifies the process of data validation and settings management in applications. It allows you to define data schemas using Python data classes with type annotations, and automatically validates and parses incoming data according to these schemas.</p>
<p>We’ve defined <code>IncomeTaxModel</code>, <code>MunicipalityDataOut</code>, <code>IncomeTaxDataOut</code>, and <code>YearDataOut</code> as Pydantic models (<code>BaseModel</code> and type annotation) to structure the data that will be sent and received by the API endpoints.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">class</span> TaxModel(BaseModel):</span>
<span id="cb6-2"><a href="#cb6-2"></a>    Municipality    :   <span class="bu">str</span>    <span class="op">=</span>  Field(<span class="st">"Name of item"</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>    Tax             :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Average tax for a given year"</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>    Year            :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Year of meassurement"</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="kw">class</span> MunicipalityDataOut(BaseModel):</span>
<span id="cb6-7"><a href="#cb6-7"></a>    Tax             :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Average tax for a given year"</span>)</span>
<span id="cb6-8"><a href="#cb6-8"></a>    Year            :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Year of meassurement"</span>)</span>
<span id="cb6-9"><a href="#cb6-9"></a>    </span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="kw">class</span> TaxDataOut(BaseModel):</span>
<span id="cb6-11"><a href="#cb6-11"></a>    Municipality    :   <span class="bu">str</span>    <span class="op">=</span>  Field(<span class="st">"Name of item"</span>)</span>
<span id="cb6-12"><a href="#cb6-12"></a>    Year            :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Year of meassurement"</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="kw">class</span> YearDataOut(BaseModel):</span>
<span id="cb6-15"><a href="#cb6-15"></a>    Municipality    :   <span class="bu">str</span>    <span class="op">=</span>  Field(<span class="st">"Name of item"</span>)</span>
<span id="cb6-16"><a href="#cb6-16"></a>    Tax             :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Average tax for a given year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="building-api-endpoints" class="level2">
<h2 class="anchored" data-anchor-id="building-api-endpoints">Building API Endpoints</h2>
<p>We proceed to define various API endpoints using FastAPI’s decorators. These endpoints cover different scenarios, from fetching data for a specific year to creating and updating entries in the database. Each endpoint corresponds to a specific HTTP method (GET, POST, PUT, DELETE) and handles specific types of requests.</p>
<p>For instance, the <code>index</code> route handles a basic GET request and returns all data from the database, ordered by the year. The <code>get_data_of_year</code> route fetches data for a given year, while <code>get_municipality_data</code> and <code>get_district_data</code> retrieve data for specific municipalities or districts, respectively. Additionally, the <code>create_new_entry</code>, <code>update_tax_entry</code>, <code>update_year_entry</code>, and <code>delete_tax_entry</code> routes allow for CRUD (Create, Read, Update, Delete) operations on the data.</p>
<p>Next, I will show you the incomplete code for the endpoints (the complete code can be found in the end of the article):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="at">@app.get</span>(<span class="st">"/"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">def</span> index():</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="cf">return</span> something</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">##&nbsp;Create a route to return data for a given year</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="at">@app.get</span>(<span class="st">"/year/</span><span class="sc">{year}</span><span class="st">"</span>)</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="kw">def</span> get_data_of_year():</span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="cf">return</span> something</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">## Create a route to return data for a given city</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="at">@app.get</span>(<span class="st">"/municipality/</span><span class="sc">{municipality}</span><span class="st">"</span>)</span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="kw">def</span> get_municipality_data():</span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="cf">return</span> something</span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">## Create a route to return data for a given district</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="at">@app.get</span>(<span class="st">"/district/</span><span class="sc">{district}</span><span class="st">"</span>)</span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="kw">def</span> get_district_data():</span>
<span id="cb7-18"><a href="#cb7-18"></a>    <span class="cf">return</span> something</span>
<span id="cb7-19"><a href="#cb7-19"></a></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">## Create a route to return data from the canton</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="at">@app.get</span>(<span class="st">"/canton/"</span>)</span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="kw">def</span> get_canton_data():</span>
<span id="cb7-23"><a href="#cb7-23"></a>    <span class="cf">return</span> something</span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">## Create a new entry</span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="at">@app.post</span>(<span class="st">'/entry/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year}</span><span class="st">/</span><span class="sc">{tax}</span><span class="st">'</span>)</span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="kw">def</span> create_new_entry():</span>
<span id="cb7-28"><a href="#cb7-28"></a>    <span class="cf">return</span> something</span>
<span id="cb7-29"><a href="#cb7-29"></a></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co">## Update an income tax entry</span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="at">@app.put</span>(<span class="st">"/update_tax/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year}</span><span class="st">/</span><span class="sc">{tax}</span><span class="st">"</span>)</span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="kw">def</span> update_tax_entry():</span>
<span id="cb7-33"><a href="#cb7-33"></a>    <span class="cf">return</span> something</span>
<span id="cb7-34"><a href="#cb7-34"></a>    </span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="co">## update year entry</span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="at">@app.put</span>(<span class="st">"/update_year/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year_old}</span><span class="st">/</span><span class="sc">{year_new}</span><span class="st">"</span>)</span>
<span id="cb7-37"><a href="#cb7-37"></a><span class="kw">def</span> update_year_entry():</span>
<span id="cb7-38"><a href="#cb7-38"></a>    <span class="cf">return</span> something</span>
<span id="cb7-39"><a href="#cb7-39"></a></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="at">@app.delete</span>(<span class="st">"/delete/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year}</span><span class="st">/</span><span class="sc">{tax}</span><span class="st">"</span>)</span>
<span id="cb7-41"><a href="#cb7-41"></a><span class="kw">def</span> delete_tax_entry():</span>
<span id="cb7-42"><a href="#cb7-42"></a>    <span class="cf">return</span> something</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The components of the the fastapi endpoints are as follows:</p>
<ol type="1">
<li>Decorators are used to define the route of each endpoints and the HTTP-method.</li>
<li>Type annotation of the parameters allows the definition and validation of the data type of the parameters.</li>
</ol>
</section>
<section id="error-handling" class="level2">
<h2 class="anchored" data-anchor-id="error-handling">Error Handling</h2>
<p>The code also incorporates error handling. For instance, if a user attempts to create a new entry that already exists in the database, an HTTPException with an appropriate status code and detail message is raised. Similarly, error handling is employed for updating and deleting entries that don’t exist in the database. The following codes are use: 400 for Bad Request, 404 for Not Found, and 500 for Internal Server Error. More information can be found <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">here</a>.</p>
<p>The implementation of error handling is done by <code>raise HTTPException()</code> as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">##&nbsp;Create a index route</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="at">@app.get</span>(<span class="st">"/"</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="kw">def</span> index() <span class="op">-&gt;</span> <span class="bu">list</span>[IncomeTaxModel]:</span>
<span id="cb8-4"><a href="#cb8-4"></a>    </span>
<span id="cb8-5"><a href="#cb8-5"></a>    ...</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a>    result <span class="op">=</span> fetch_return_dict(stmt)</span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="cf">if</span> result:</span>
<span id="cb8-10"><a href="#cb8-10"></a>        <span class="cf">return</span> result</span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="cf">else</span>:</span>
<span id="cb8-12"><a href="#cb8-12"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb8-13"><a href="#cb8-13"></a>            status_code <span class="op">=</span> <span class="dv">404</span>, </span>
<span id="cb8-14"><a href="#cb8-14"></a>            detail <span class="op">=</span> <span class="ss">f"Item not found"</span>,</span>
<span id="cb8-15"><a href="#cb8-15"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="api-documentation" class="level1">
<h1>API-Documentation</h1>
<p>FastAPI provides a built-in documentation system that is automatically generated based on the API’s metadata and doc-strings provided. The documentation is accessible at the <code>/docs</code> and <code>/redoc</code> endpoint (we focus in this tutorial on <code>/docs</code> page only). The documentation is interactive and allows users to test the API directly from the browser. The documentation is also available in JSON format at the <code>/openapi.json</code> endpoint.</p>
<div id="fig-docpages" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-api1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../imgs/api_doc_11.png" class="img-fluid figure-img" data-ref-parent="fig-docpages"></p>
<p></p><figcaption class="figure-caption">(a) API docs: API description and methods</figcaption><p></p>
</figure>
</div>
<div id="fig-api2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../imgs/api_doc_22.png" class="img-fluid figure-img" data-ref-parent="fig-docpages"></p>
<p></p><figcaption class="figure-caption">(b) API docs: Data schema description</figcaption><p></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: API docs page for the API service. The documentation is interactive and allows users to test the API directly from the browser.</figcaption><p></p>
</figure>
</div>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In this article, we’ve walked through the creation of a FastAPI web service for accessing income tax data. We’ve covered the setup process, defining data models, creating API endpoints, and handling database interactions. FastAPI’s intuitive syntax and powerful features make it a fantastic choice for building efficient and robust APIs. This project serves as a foundation, demonstrating how to construct APIs that facilitate data retrieval and manipulation, crucial tasks in today’s data-centric world.</p>
<p>Overall, this FastAPI-based web service exemplifies the elegance and utility of modern Python frameworks in building APIs that bridge the gap between data and applications.</p>
</section>
</section>
<section id="appendix-complete-code" class="level1">
<h1>Appendix: Complete code</h1>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, HTTPException</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine, MetaData, Table, select, insert, update, delete</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">## Create a metadata object</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>metadata <span class="op">=</span> MetaData()</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">## Create a connection to the database</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>engine <span class="op">=</span> create_engine(              </span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="co">## Path to database                     </span></span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="st">'sqlite:///../../data/FastAPI.db'</span>,      <span class="co">#&nbsp;&lt;1&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>)</span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">## Reflect census table from the engine: census</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>fastapi <span class="op">=</span> Table(</span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="st">"fastapi"</span>, </span>
<span id="cb9-20"><a href="#cb9-20"></a>    metadata,</span>
<span id="cb9-21"><a href="#cb9-21"></a>    autoload_with <span class="op">=</span> engine,</span>
<span id="cb9-22"><a href="#cb9-22"></a>)</span>
<span id="cb9-23"><a href="#cb9-23"></a></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">## Helper function to fetch data</span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="kw">def</span> fetch_return_dict(</span>
<span id="cb9-26"><a href="#cb9-26"></a>        stmt, </span>
<span id="cb9-27"><a href="#cb9-27"></a>        engine <span class="op">=</span> engine,</span>
<span id="cb9-28"><a href="#cb9-28"></a>    ) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb9-29"><a href="#cb9-29"></a>    <span class="co">"""</span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co">    Utility function to convert sql query results to dict via pandas dataframe</span></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co">    """</span></span>
<span id="cb9-32"><a href="#cb9-32"></a>    <span class="co">## Create a connection to the database</span></span>
<span id="cb9-33"><a href="#cb9-33"></a>    connection <span class="op">=</span> engine.<span class="ex">connect</span>()</span>
<span id="cb9-34"><a href="#cb9-34"></a>    data <span class="op">=</span> connection.execute(stmt).fetchall()</span>
<span id="cb9-35"><a href="#cb9-35"></a>    connection.close()</span>
<span id="cb9-36"><a href="#cb9-36"></a></span>
<span id="cb9-37"><a href="#cb9-37"></a>    <span class="cf">return</span> (</span>
<span id="cb9-38"><a href="#cb9-38"></a>        pd.DataFrame(</span>
<span id="cb9-39"><a href="#cb9-39"></a>            data <span class="op">=</span> data</span>
<span id="cb9-40"><a href="#cb9-40"></a>        )</span>
<span id="cb9-41"><a href="#cb9-41"></a>        .to_dict(</span>
<span id="cb9-42"><a href="#cb9-42"></a>            orient <span class="op">=</span> <span class="st">"records"</span>, </span>
<span id="cb9-43"><a href="#cb9-43"></a>        )</span>
<span id="cb9-44"><a href="#cb9-44"></a>    )</span>
<span id="cb9-45"><a href="#cb9-45"></a></span>
<span id="cb9-46"><a href="#cb9-46"></a><span class="co">## Instantiate a FastAPI object</span></span>
<span id="cb9-47"><a href="#cb9-47"></a>app <span class="op">=</span> FastAPI(</span>
<span id="cb9-48"><a href="#cb9-48"></a>    title           <span class="op">=</span>   <span class="st">"My first API"</span>,</span>
<span id="cb9-49"><a href="#cb9-49"></a>    description     <span class="op">=</span>   <span class="st">"""</span></span>
<span id="cb9-50"><a href="#cb9-50"></a><span class="st">    API for access of wealth tax data from the canton of Zurich, Switzerland. </span></span>
<span id="cb9-51"><a href="#cb9-51"></a><span class="st">    Basic CRUD operations are supported (Create, Read, Update, Delete)</span></span>
<span id="cb9-52"><a href="#cb9-52"></a></span>
<span id="cb9-53"><a href="#cb9-53"></a><span class="st">    # To-Do:</span></span>
<span id="cb9-54"><a href="#cb9-54"></a><span class="st">    - Add tag parameter to routes decorators see https://fastapi.tiangolo.com/tutorial/metadata/</span></span>
<span id="cb9-55"><a href="#cb9-55"></a><span class="st">    - Check HTTPException status codes</span></span>
<span id="cb9-56"><a href="#cb9-56"></a><span class="st">    </span></span>
<span id="cb9-57"><a href="#cb9-57"></a><span class="st">    # Future:</span></span>
<span id="cb9-58"><a href="#cb9-58"></a><span class="st">    - Add more routes</span></span>
<span id="cb9-59"><a href="#cb9-59"></a><span class="st">    - Create Authentication</span></span>
<span id="cb9-60"><a href="#cb9-60"></a><span class="st">    - Create separate modules for routes, database connection, etc.</span></span>
<span id="cb9-61"><a href="#cb9-61"></a></span>
<span id="cb9-62"><a href="#cb9-62"></a><span class="st">    © 2023, Bernardo Freire Barboza da Cruz</span></span>
<span id="cb9-63"><a href="#cb9-63"></a><span class="st">    """</span>,</span>
<span id="cb9-64"><a href="#cb9-64"></a>    version         <span class="op">=</span>   <span class="st">"0.0.1"</span>,</span>
<span id="cb9-65"><a href="#cb9-65"></a>)</span>
<span id="cb9-66"><a href="#cb9-66"></a></span>
<span id="cb9-67"><a href="#cb9-67"></a><span class="co">## Create a BaseModel Child class for data representation</span></span>
<span id="cb9-68"><a href="#cb9-68"></a><span class="kw">class</span> TaxModel(BaseModel):</span>
<span id="cb9-69"><a href="#cb9-69"></a>    Municipality    :   <span class="bu">str</span>    <span class="op">=</span>  Field(<span class="st">"Name of item"</span>)</span>
<span id="cb9-70"><a href="#cb9-70"></a>    Tax             :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Average tax for a given year"</span>)</span>
<span id="cb9-71"><a href="#cb9-71"></a>    Year            :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Year of meassurement"</span>)</span>
<span id="cb9-72"><a href="#cb9-72"></a></span>
<span id="cb9-73"><a href="#cb9-73"></a><span class="kw">class</span> MunicipalityDataOut(BaseModel):</span>
<span id="cb9-74"><a href="#cb9-74"></a>    Tax             :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Average tax for a given year"</span>)</span>
<span id="cb9-75"><a href="#cb9-75"></a>    Year            :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Year of meassurement"</span>)</span>
<span id="cb9-76"><a href="#cb9-76"></a>    </span>
<span id="cb9-77"><a href="#cb9-77"></a><span class="kw">class</span> TaxDataOut(BaseModel):</span>
<span id="cb9-78"><a href="#cb9-78"></a>    Municipality    :   <span class="bu">str</span>    <span class="op">=</span>  Field(<span class="st">"Name of item"</span>)</span>
<span id="cb9-79"><a href="#cb9-79"></a>    Year            :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Year of meassurement"</span>)</span>
<span id="cb9-80"><a href="#cb9-80"></a></span>
<span id="cb9-81"><a href="#cb9-81"></a><span class="kw">class</span> YearDataOut(BaseModel):</span>
<span id="cb9-82"><a href="#cb9-82"></a>    Municipality    :   <span class="bu">str</span>    <span class="op">=</span>  Field(<span class="st">"Name of item"</span>)</span>
<span id="cb9-83"><a href="#cb9-83"></a>    Tax             :   <span class="bu">int</span>    <span class="op">=</span>  Field(<span class="st">"Average tax for a given year"</span>)</span>
<span id="cb9-84"><a href="#cb9-84"></a> </span>
<span id="cb9-85"><a href="#cb9-85"></a><span class="co">##&nbsp;Create a index route</span></span>
<span id="cb9-86"><a href="#cb9-86"></a><span class="at">@app.get</span>(<span class="st">"/"</span>)</span>
<span id="cb9-87"><a href="#cb9-87"></a><span class="kw">def</span> index() <span class="op">-&gt;</span> <span class="bu">list</span>[TaxModel]:</span>
<span id="cb9-88"><a href="#cb9-88"></a>    <span class="co">"""</span></span>
<span id="cb9-89"><a href="#cb9-89"></a><span class="co">    Returns all data from the fastapi table</span></span>
<span id="cb9-90"><a href="#cb9-90"></a><span class="co">    """</span></span>
<span id="cb9-91"><a href="#cb9-91"></a>    stmt <span class="op">=</span> (</span>
<span id="cb9-92"><a href="#cb9-92"></a>        <span class="co">##&nbsp;Select ALL columns from the census table</span></span>
<span id="cb9-93"><a href="#cb9-93"></a>        select(</span>
<span id="cb9-94"><a href="#cb9-94"></a>            fastapi</span>
<span id="cb9-95"><a href="#cb9-95"></a>        )</span>
<span id="cb9-96"><a href="#cb9-96"></a>        <span class="co">## Order by the Year column</span></span>
<span id="cb9-97"><a href="#cb9-97"></a>        .order_by(</span>
<span id="cb9-98"><a href="#cb9-98"></a>            fastapi.columns.Year.desc()</span>
<span id="cb9-99"><a href="#cb9-99"></a>        )</span>
<span id="cb9-100"><a href="#cb9-100"></a>    ) </span>
<span id="cb9-101"><a href="#cb9-101"></a></span>
<span id="cb9-102"><a href="#cb9-102"></a>    result <span class="op">=</span> fetch_return_dict(stmt)</span>
<span id="cb9-103"><a href="#cb9-103"></a></span>
<span id="cb9-104"><a href="#cb9-104"></a>    <span class="cf">if</span> result:</span>
<span id="cb9-105"><a href="#cb9-105"></a>        <span class="cf">return</span> result</span>
<span id="cb9-106"><a href="#cb9-106"></a>    <span class="cf">else</span>:</span>
<span id="cb9-107"><a href="#cb9-107"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-108"><a href="#cb9-108"></a>            status_code <span class="op">=</span> <span class="dv">404</span>, </span>
<span id="cb9-109"><a href="#cb9-109"></a>            detail <span class="op">=</span> <span class="ss">f"Item not found"</span>,</span>
<span id="cb9-110"><a href="#cb9-110"></a>        )</span>
<span id="cb9-111"><a href="#cb9-111"></a></span>
<span id="cb9-112"><a href="#cb9-112"></a><span class="co">##&nbsp;Create a route to return data for a given year</span></span>
<span id="cb9-113"><a href="#cb9-113"></a><span class="at">@app.get</span>(<span class="st">"/year/</span><span class="sc">{year}</span><span class="st">"</span>)</span>
<span id="cb9-114"><a href="#cb9-114"></a><span class="kw">def</span> get_data_of_year(year: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[YearDataOut]:</span>
<span id="cb9-115"><a href="#cb9-115"></a>    <span class="co">"""</span></span>
<span id="cb9-116"><a href="#cb9-116"></a><span class="co">    Returns all data from the fastapi table for a given year</span></span>
<span id="cb9-117"><a href="#cb9-117"></a><span class="co">    """</span></span>
<span id="cb9-118"><a href="#cb9-118"></a>    <span class="co">## Create an sql statement to select ALL columns from the census table</span></span>
<span id="cb9-119"><a href="#cb9-119"></a>    stmt <span class="op">=</span> (</span>
<span id="cb9-120"><a href="#cb9-120"></a>        <span class="co">##&nbsp;Select ALL columns from the census table</span></span>
<span id="cb9-121"><a href="#cb9-121"></a>        select(</span>
<span id="cb9-122"><a href="#cb9-122"></a>            fastapi.columns.Municipality, </span>
<span id="cb9-123"><a href="#cb9-123"></a>            fastapi.columns.Tax</span>
<span id="cb9-124"><a href="#cb9-124"></a>        )</span>
<span id="cb9-125"><a href="#cb9-125"></a>        <span class="co">## Order by the Year column</span></span>
<span id="cb9-126"><a href="#cb9-126"></a>        .order_by(</span>
<span id="cb9-127"><a href="#cb9-127"></a>            fastapi.columns.Year.desc()</span>
<span id="cb9-128"><a href="#cb9-128"></a>        )</span>
<span id="cb9-129"><a href="#cb9-129"></a>        .where(</span>
<span id="cb9-130"><a href="#cb9-130"></a>            fastapi.columns.Year <span class="op">==</span> year</span>
<span id="cb9-131"><a href="#cb9-131"></a>        )</span>
<span id="cb9-132"><a href="#cb9-132"></a>    )</span>
<span id="cb9-133"><a href="#cb9-133"></a>    </span>
<span id="cb9-134"><a href="#cb9-134"></a>    <span class="co">## Execute the statement and fetch the results</span></span>
<span id="cb9-135"><a href="#cb9-135"></a>    result <span class="op">=</span> fetch_return_dict(stmt)</span>
<span id="cb9-136"><a href="#cb9-136"></a>    </span>
<span id="cb9-137"><a href="#cb9-137"></a>    <span class="co">## If the result is not empty return it, otherwise raise an exception</span></span>
<span id="cb9-138"><a href="#cb9-138"></a>    <span class="cf">if</span> result:</span>
<span id="cb9-139"><a href="#cb9-139"></a>        <span class="cf">return</span> result</span>
<span id="cb9-140"><a href="#cb9-140"></a>    <span class="cf">else</span>:</span>
<span id="cb9-141"><a href="#cb9-141"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-142"><a href="#cb9-142"></a>            status_code <span class="op">=</span> <span class="dv">404</span>, </span>
<span id="cb9-143"><a href="#cb9-143"></a>            detail <span class="op">=</span> <span class="ss">f"Item not found"</span>,</span>
<span id="cb9-144"><a href="#cb9-144"></a>        )</span>
<span id="cb9-145"><a href="#cb9-145"></a></span>
<span id="cb9-146"><a href="#cb9-146"></a><span class="co">## Create a route to return data for a given city</span></span>
<span id="cb9-147"><a href="#cb9-147"></a><span class="at">@app.get</span>(<span class="st">"/municipality/</span><span class="sc">{municipality}</span><span class="st">"</span>)</span>
<span id="cb9-148"><a href="#cb9-148"></a><span class="kw">def</span> get_municipality_data(municipality: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[MunicipalityDataOut]:</span>
<span id="cb9-149"><a href="#cb9-149"></a>    <span class="co">"""</span></span>
<span id="cb9-150"><a href="#cb9-150"></a><span class="co">    Returns all data from the fastapi table for a given municipality</span></span>
<span id="cb9-151"><a href="#cb9-151"></a><span class="co">    """</span></span>
<span id="cb9-152"><a href="#cb9-152"></a>    <span class="co">## Create an sql statement to select ALL columns from the census table</span></span>
<span id="cb9-153"><a href="#cb9-153"></a>    stmt <span class="op">=</span> (</span>
<span id="cb9-154"><a href="#cb9-154"></a>        <span class="co">##&nbsp;Select ALL columns from the census table</span></span>
<span id="cb9-155"><a href="#cb9-155"></a>        select(</span>
<span id="cb9-156"><a href="#cb9-156"></a>            fastapi.columns.Year, </span>
<span id="cb9-157"><a href="#cb9-157"></a>            fastapi.columns.Tax</span>
<span id="cb9-158"><a href="#cb9-158"></a>        )</span>
<span id="cb9-159"><a href="#cb9-159"></a>        <span class="co">## Order by the Year column</span></span>
<span id="cb9-160"><a href="#cb9-160"></a>        .order_by(</span>
<span id="cb9-161"><a href="#cb9-161"></a>            fastapi.columns.Year.desc()</span>
<span id="cb9-162"><a href="#cb9-162"></a>        )</span>
<span id="cb9-163"><a href="#cb9-163"></a>        .where(</span>
<span id="cb9-164"><a href="#cb9-164"></a>            (<span class="op">~</span>fastapi.columns.Municipality.startswith(<span class="st">'Bezirk'</span>)) <span class="op">&amp;</span> </span>
<span id="cb9-165"><a href="#cb9-165"></a>            (<span class="op">~</span>fastapi.columns.Municipality.startswith(<span class="st">'Region'</span>)) <span class="op">&amp;</span></span>
<span id="cb9-166"><a href="#cb9-166"></a>            (fastapi.columns.Municipality <span class="op">==</span> municipality)</span>
<span id="cb9-167"><a href="#cb9-167"></a>        )</span>
<span id="cb9-168"><a href="#cb9-168"></a>        </span>
<span id="cb9-169"><a href="#cb9-169"></a>    )</span>
<span id="cb9-170"><a href="#cb9-170"></a>    </span>
<span id="cb9-171"><a href="#cb9-171"></a>    <span class="co">## Execute the statement and fetch the results</span></span>
<span id="cb9-172"><a href="#cb9-172"></a>    result <span class="op">=</span> fetch_return_dict(stmt)</span>
<span id="cb9-173"><a href="#cb9-173"></a>    </span>
<span id="cb9-174"><a href="#cb9-174"></a>    <span class="co">## If the result is not empty return it, otherwise raise an exception</span></span>
<span id="cb9-175"><a href="#cb9-175"></a>    <span class="cf">if</span> result:</span>
<span id="cb9-176"><a href="#cb9-176"></a>        <span class="cf">return</span> result</span>
<span id="cb9-177"><a href="#cb9-177"></a>    <span class="cf">else</span>:</span>
<span id="cb9-178"><a href="#cb9-178"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-179"><a href="#cb9-179"></a>            status_code <span class="op">=</span> <span class="dv">404</span>, </span>
<span id="cb9-180"><a href="#cb9-180"></a>            detail <span class="op">=</span> <span class="ss">f"Item not found"</span>,</span>
<span id="cb9-181"><a href="#cb9-181"></a>        )</span>
<span id="cb9-182"><a href="#cb9-182"></a></span>
<span id="cb9-183"><a href="#cb9-183"></a><span class="co">## Create a route to return data for a given district</span></span>
<span id="cb9-184"><a href="#cb9-184"></a><span class="at">@app.get</span>(<span class="st">"/district/</span><span class="sc">{district}</span><span class="st">"</span>)</span>
<span id="cb9-185"><a href="#cb9-185"></a><span class="kw">def</span> get_district_data(district: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[MunicipalityDataOut]:</span>
<span id="cb9-186"><a href="#cb9-186"></a>    <span class="co">"""</span></span>
<span id="cb9-187"><a href="#cb9-187"></a><span class="co">    Returns all data from the fastapi table for a given district</span></span>
<span id="cb9-188"><a href="#cb9-188"></a><span class="co">    """</span></span>
<span id="cb9-189"><a href="#cb9-189"></a>    <span class="co">## Create an sql statement to select ALL columns from the census table</span></span>
<span id="cb9-190"><a href="#cb9-190"></a>    stmt <span class="op">=</span> (</span>
<span id="cb9-191"><a href="#cb9-191"></a>        <span class="co">##&nbsp;Select ALL columns from the census table</span></span>
<span id="cb9-192"><a href="#cb9-192"></a>        select(</span>
<span id="cb9-193"><a href="#cb9-193"></a>            fastapi.columns.Year, </span>
<span id="cb9-194"><a href="#cb9-194"></a>            fastapi.columns.Tax</span>
<span id="cb9-195"><a href="#cb9-195"></a>        )</span>
<span id="cb9-196"><a href="#cb9-196"></a>        <span class="co">## Order by the Year column</span></span>
<span id="cb9-197"><a href="#cb9-197"></a>        .order_by(</span>
<span id="cb9-198"><a href="#cb9-198"></a>            fastapi.columns.Year.desc()</span>
<span id="cb9-199"><a href="#cb9-199"></a>        )</span>
<span id="cb9-200"><a href="#cb9-200"></a>        .where(</span>
<span id="cb9-201"><a href="#cb9-201"></a>            (fastapi.columns.Municipality.startswith(<span class="st">'Bezirk'</span>)) <span class="op">&amp;</span> </span>
<span id="cb9-202"><a href="#cb9-202"></a>            (fastapi.columns.Municipality.contains(district))</span>
<span id="cb9-203"><a href="#cb9-203"></a>        )</span>
<span id="cb9-204"><a href="#cb9-204"></a>        </span>
<span id="cb9-205"><a href="#cb9-205"></a>    )</span>
<span id="cb9-206"><a href="#cb9-206"></a>    </span>
<span id="cb9-207"><a href="#cb9-207"></a>    <span class="co">## Execute the statement and fetch the results</span></span>
<span id="cb9-208"><a href="#cb9-208"></a>    result <span class="op">=</span> fetch_return_dict(stmt)</span>
<span id="cb9-209"><a href="#cb9-209"></a>    </span>
<span id="cb9-210"><a href="#cb9-210"></a>    <span class="co">## If the result is not empty return it, otherwise raise an exception</span></span>
<span id="cb9-211"><a href="#cb9-211"></a>    <span class="cf">if</span> result:</span>
<span id="cb9-212"><a href="#cb9-212"></a>        <span class="cf">return</span> result</span>
<span id="cb9-213"><a href="#cb9-213"></a>    <span class="cf">else</span>:</span>
<span id="cb9-214"><a href="#cb9-214"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-215"><a href="#cb9-215"></a>            status_code <span class="op">=</span> <span class="dv">404</span>, </span>
<span id="cb9-216"><a href="#cb9-216"></a>            detail <span class="op">=</span> <span class="ss">f"Item not found"</span>,</span>
<span id="cb9-217"><a href="#cb9-217"></a>        )</span>
<span id="cb9-218"><a href="#cb9-218"></a></span>
<span id="cb9-219"><a href="#cb9-219"></a><span class="co">## Create a route to return data from the canton</span></span>
<span id="cb9-220"><a href="#cb9-220"></a><span class="at">@app.get</span>(<span class="st">"/canton/"</span>)</span>
<span id="cb9-221"><a href="#cb9-221"></a><span class="kw">def</span> get_canton_data() <span class="op">-&gt;</span> <span class="bu">list</span>[MunicipalityDataOut]:</span>
<span id="cb9-222"><a href="#cb9-222"></a>    <span class="co">"""</span></span>
<span id="cb9-223"><a href="#cb9-223"></a><span class="co">    Returns all data from the fastapi table for the canton</span></span>
<span id="cb9-224"><a href="#cb9-224"></a><span class="co">    """</span></span>
<span id="cb9-225"><a href="#cb9-225"></a>    <span class="co">## Create an sql statement to select ALL columns from the census table</span></span>
<span id="cb9-226"><a href="#cb9-226"></a>    stmt <span class="op">=</span> (</span>
<span id="cb9-227"><a href="#cb9-227"></a>        <span class="co">##&nbsp;Select ALL columns from the census table</span></span>
<span id="cb9-228"><a href="#cb9-228"></a>        select(</span>
<span id="cb9-229"><a href="#cb9-229"></a>            fastapi.columns.Year, </span>
<span id="cb9-230"><a href="#cb9-230"></a>            fastapi.columns.Tax</span>
<span id="cb9-231"><a href="#cb9-231"></a>        )</span>
<span id="cb9-232"><a href="#cb9-232"></a>        <span class="co">## Order by the Year column</span></span>
<span id="cb9-233"><a href="#cb9-233"></a>        .order_by(</span>
<span id="cb9-234"><a href="#cb9-234"></a>            fastapi.columns.Year.desc()</span>
<span id="cb9-235"><a href="#cb9-235"></a>        )</span>
<span id="cb9-236"><a href="#cb9-236"></a>        .where(</span>
<span id="cb9-237"><a href="#cb9-237"></a>            fastapi.columns.Municipality.contains(<span class="st">'Kanton'</span>)</span>
<span id="cb9-238"><a href="#cb9-238"></a>        )</span>
<span id="cb9-239"><a href="#cb9-239"></a>        </span>
<span id="cb9-240"><a href="#cb9-240"></a>    )</span>
<span id="cb9-241"><a href="#cb9-241"></a>    </span>
<span id="cb9-242"><a href="#cb9-242"></a>    <span class="co">## Execute the statement and fetch the results</span></span>
<span id="cb9-243"><a href="#cb9-243"></a>    result <span class="op">=</span> fetch_return_dict(stmt)</span>
<span id="cb9-244"><a href="#cb9-244"></a>    </span>
<span id="cb9-245"><a href="#cb9-245"></a>    <span class="co">## If the result is not empty return it, otherwise raise an exception</span></span>
<span id="cb9-246"><a href="#cb9-246"></a>    <span class="cf">if</span> result:</span>
<span id="cb9-247"><a href="#cb9-247"></a>        <span class="cf">return</span> result</span>
<span id="cb9-248"><a href="#cb9-248"></a>    <span class="cf">else</span>:</span>
<span id="cb9-249"><a href="#cb9-249"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-250"><a href="#cb9-250"></a>            status_code <span class="op">=</span> <span class="dv">404</span>, </span>
<span id="cb9-251"><a href="#cb9-251"></a>            detail <span class="op">=</span> <span class="ss">f"Item not found"</span>,</span>
<span id="cb9-252"><a href="#cb9-252"></a>        )</span>
<span id="cb9-253"><a href="#cb9-253"></a></span>
<span id="cb9-254"><a href="#cb9-254"></a><span class="co">## Create a new entry</span></span>
<span id="cb9-255"><a href="#cb9-255"></a><span class="at">@app.post</span>(<span class="st">'/entry/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year}</span><span class="st">/</span><span class="sc">{tax}</span><span class="st">'</span>)</span>
<span id="cb9-256"><a href="#cb9-256"></a><span class="kw">def</span> create_new_entry(</span>
<span id="cb9-257"><a href="#cb9-257"></a>        municipality    : <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-258"><a href="#cb9-258"></a>        year            : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-259"><a href="#cb9-259"></a>        tax             : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-260"><a href="#cb9-260"></a>    ):</span>
<span id="cb9-261"><a href="#cb9-261"></a>    <span class="co">"""</span></span>
<span id="cb9-262"><a href="#cb9-262"></a><span class="co">    Create a new entry in database</span></span>
<span id="cb9-263"><a href="#cb9-263"></a><span class="co">    """</span></span>
<span id="cb9-264"><a href="#cb9-264"></a>    in_stmt <span class="op">=</span> (</span>
<span id="cb9-265"><a href="#cb9-265"></a>        select(</span>
<span id="cb9-266"><a href="#cb9-266"></a>            fastapi</span>
<span id="cb9-267"><a href="#cb9-267"></a>        )</span>
<span id="cb9-268"><a href="#cb9-268"></a>        .where(</span>
<span id="cb9-269"><a href="#cb9-269"></a>            fastapi.columns.Municipality <span class="op">==</span> municipality,</span>
<span id="cb9-270"><a href="#cb9-270"></a>            fastapi.columns.Year <span class="op">==</span> year,</span>
<span id="cb9-271"><a href="#cb9-271"></a>        )</span>
<span id="cb9-272"><a href="#cb9-272"></a>    )</span>
<span id="cb9-273"><a href="#cb9-273"></a>    </span>
<span id="cb9-274"><a href="#cb9-274"></a>    connection <span class="op">=</span> engine.<span class="ex">connect</span>()</span>
<span id="cb9-275"><a href="#cb9-275"></a>    result <span class="op">=</span> connection.execute(in_stmt).fetchall()</span>
<span id="cb9-276"><a href="#cb9-276"></a>    </span>
<span id="cb9-277"><a href="#cb9-277"></a>    <span class="cf">if</span> result:</span>
<span id="cb9-278"><a href="#cb9-278"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-279"><a href="#cb9-279"></a>            status_code<span class="op">=</span><span class="dv">405</span>, </span>
<span id="cb9-280"><a href="#cb9-280"></a>            detail <span class="op">=</span> <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss"> and year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> already exists. "</span></span>
<span id="cb9-281"><a href="#cb9-281"></a>            <span class="op">+</span> <span class="st">"Use update to change this value or delete this entry and retry"</span>,</span>
<span id="cb9-282"><a href="#cb9-282"></a>        )</span>
<span id="cb9-283"><a href="#cb9-283"></a>    <span class="cf">else</span>:</span>
<span id="cb9-284"><a href="#cb9-284"></a>        stmt <span class="op">=</span> (</span>
<span id="cb9-285"><a href="#cb9-285"></a>            insert(</span>
<span id="cb9-286"><a href="#cb9-286"></a>                fastapi</span>
<span id="cb9-287"><a href="#cb9-287"></a>            )</span>
<span id="cb9-288"><a href="#cb9-288"></a>            .values(</span>
<span id="cb9-289"><a href="#cb9-289"></a>                Municipality <span class="op">=</span> municipality,</span>
<span id="cb9-290"><a href="#cb9-290"></a>                Year <span class="op">=</span> year,</span>
<span id="cb9-291"><a href="#cb9-291"></a>                Tax <span class="op">=</span> tax,</span>
<span id="cb9-292"><a href="#cb9-292"></a>            )</span>
<span id="cb9-293"><a href="#cb9-293"></a>        )</span>
<span id="cb9-294"><a href="#cb9-294"></a></span>
<span id="cb9-295"><a href="#cb9-295"></a>        connection.execute(stmt)</span>
<span id="cb9-296"><a href="#cb9-296"></a>        connection.commit()</span>
<span id="cb9-297"><a href="#cb9-297"></a>        connection.close()</span>
<span id="cb9-298"><a href="#cb9-298"></a></span>
<span id="cb9-299"><a href="#cb9-299"></a>        <span class="cf">return</span> {<span class="st">"success"</span>: <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss">; tax of </span><span class="sc">{</span>tax<span class="sc">}</span><span class="ss">; and year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> added."</span>}</span>
<span id="cb9-300"><a href="#cb9-300"></a></span>
<span id="cb9-301"><a href="#cb9-301"></a><span class="co">## Update an income tax entry</span></span>
<span id="cb9-302"><a href="#cb9-302"></a><span class="at">@app.put</span>(<span class="st">"/update_tax/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year}</span><span class="st">/</span><span class="sc">{tax}</span><span class="st">"</span>)</span>
<span id="cb9-303"><a href="#cb9-303"></a><span class="kw">def</span> update_tax_entry(</span>
<span id="cb9-304"><a href="#cb9-304"></a>        municipality    : <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-305"><a href="#cb9-305"></a>        year            : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-306"><a href="#cb9-306"></a>        tax             : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-307"><a href="#cb9-307"></a>    ):</span>
<span id="cb9-308"><a href="#cb9-308"></a>    <span class="co">"""</span></span>
<span id="cb9-309"><a href="#cb9-309"></a><span class="co">    Update income tax value for a given municipality and year </span></span>
<span id="cb9-310"><a href="#cb9-310"></a><span class="co">    """</span></span>
<span id="cb9-311"><a href="#cb9-311"></a>    in_stmt <span class="op">=</span> (</span>
<span id="cb9-312"><a href="#cb9-312"></a>        select(</span>
<span id="cb9-313"><a href="#cb9-313"></a>            fastapi</span>
<span id="cb9-314"><a href="#cb9-314"></a>        )</span>
<span id="cb9-315"><a href="#cb9-315"></a>        .where(</span>
<span id="cb9-316"><a href="#cb9-316"></a>            fastapi.columns.Municipality <span class="op">==</span> municipality,</span>
<span id="cb9-317"><a href="#cb9-317"></a>            fastapi.columns.Year <span class="op">==</span> year,</span>
<span id="cb9-318"><a href="#cb9-318"></a>        )</span>
<span id="cb9-319"><a href="#cb9-319"></a>    )</span>
<span id="cb9-320"><a href="#cb9-320"></a>    </span>
<span id="cb9-321"><a href="#cb9-321"></a>    connection <span class="op">=</span> engine.<span class="ex">connect</span>()</span>
<span id="cb9-322"><a href="#cb9-322"></a>    result <span class="op">=</span> connection.execute(in_stmt).fetchall()</span>
<span id="cb9-323"><a href="#cb9-323"></a></span>
<span id="cb9-324"><a href="#cb9-324"></a>    <span class="cf">if</span> <span class="kw">not</span> result:</span>
<span id="cb9-325"><a href="#cb9-325"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-326"><a href="#cb9-326"></a>            status_code<span class="op">=</span><span class="dv">404</span>, </span>
<span id="cb9-327"><a href="#cb9-327"></a>            detail <span class="op">=</span> <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss"> and year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> not found. "</span></span>
<span id="cb9-328"><a href="#cb9-328"></a>            <span class="op">+</span> <span class="st">"Only values available in database can be updated"</span></span>
<span id="cb9-329"><a href="#cb9-329"></a>        )</span>
<span id="cb9-330"><a href="#cb9-330"></a>    <span class="cf">else</span>:</span>
<span id="cb9-331"><a href="#cb9-331"></a>        stmt <span class="op">=</span> (</span>
<span id="cb9-332"><a href="#cb9-332"></a>            update(</span>
<span id="cb9-333"><a href="#cb9-333"></a>                fastapi</span>
<span id="cb9-334"><a href="#cb9-334"></a>            )</span>
<span id="cb9-335"><a href="#cb9-335"></a>            .where(</span>
<span id="cb9-336"><a href="#cb9-336"></a>                fastapi.columns.Municipality <span class="op">==</span> municipality,</span>
<span id="cb9-337"><a href="#cb9-337"></a>                fastapi.columns.Year <span class="op">==</span> year,</span>
<span id="cb9-338"><a href="#cb9-338"></a>            )</span>
<span id="cb9-339"><a href="#cb9-339"></a>            .values(</span>
<span id="cb9-340"><a href="#cb9-340"></a>                Tax <span class="op">=</span> tax,</span>
<span id="cb9-341"><a href="#cb9-341"></a>            )</span>
<span id="cb9-342"><a href="#cb9-342"></a>        )</span>
<span id="cb9-343"><a href="#cb9-343"></a></span>
<span id="cb9-344"><a href="#cb9-344"></a>        connection.execute(stmt)</span>
<span id="cb9-345"><a href="#cb9-345"></a>        connection.commit()</span>
<span id="cb9-346"><a href="#cb9-346"></a>        connection.close()</span>
<span id="cb9-347"><a href="#cb9-347"></a></span>
<span id="cb9-348"><a href="#cb9-348"></a>        <span class="cf">return</span> {<span class="st">"success"</span>: <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss">; and year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> updated to tax of </span><span class="sc">{</span>tax<span class="sc">}</span><span class="ss">;"</span>}</span>
<span id="cb9-349"><a href="#cb9-349"></a>    </span>
<span id="cb9-350"><a href="#cb9-350"></a><span class="co">## update year entry</span></span>
<span id="cb9-351"><a href="#cb9-351"></a><span class="at">@app.put</span>(<span class="st">"/update_year/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year_old}</span><span class="st">/</span><span class="sc">{year_new}</span><span class="st">"</span>)</span>
<span id="cb9-352"><a href="#cb9-352"></a><span class="kw">def</span> update_year_entry(</span>
<span id="cb9-353"><a href="#cb9-353"></a>        municipality    : <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-354"><a href="#cb9-354"></a>        year_old        : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-355"><a href="#cb9-355"></a>        year_new        : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-356"><a href="#cb9-356"></a>    ):</span>
<span id="cb9-357"><a href="#cb9-357"></a>    <span class="co">"""</span></span>
<span id="cb9-358"><a href="#cb9-358"></a><span class="co">    Update year of a municipality entry</span></span>
<span id="cb9-359"><a href="#cb9-359"></a><span class="co">    """</span></span>
<span id="cb9-360"><a href="#cb9-360"></a>    in_stmt <span class="op">=</span> (</span>
<span id="cb9-361"><a href="#cb9-361"></a>        select(</span>
<span id="cb9-362"><a href="#cb9-362"></a>            fastapi</span>
<span id="cb9-363"><a href="#cb9-363"></a>        )</span>
<span id="cb9-364"><a href="#cb9-364"></a>        .where(</span>
<span id="cb9-365"><a href="#cb9-365"></a>            fastapi.columns.Municipality <span class="op">==</span> municipality,</span>
<span id="cb9-366"><a href="#cb9-366"></a>            fastapi.columns.Year <span class="op">==</span> year_old,</span>
<span id="cb9-367"><a href="#cb9-367"></a>        )</span>
<span id="cb9-368"><a href="#cb9-368"></a>    )</span>
<span id="cb9-369"><a href="#cb9-369"></a>    </span>
<span id="cb9-370"><a href="#cb9-370"></a>    connection <span class="op">=</span> engine.<span class="ex">connect</span>()</span>
<span id="cb9-371"><a href="#cb9-371"></a>    result <span class="op">=</span> connection.execute(in_stmt).fetchall()</span>
<span id="cb9-372"><a href="#cb9-372"></a></span>
<span id="cb9-373"><a href="#cb9-373"></a>    <span class="cf">if</span> <span class="kw">not</span> result:</span>
<span id="cb9-374"><a href="#cb9-374"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-375"><a href="#cb9-375"></a>            status_code<span class="op">=</span><span class="dv">404</span>, </span>
<span id="cb9-376"><a href="#cb9-376"></a>            detail <span class="op">=</span> <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss"> and year </span><span class="sc">{</span>year_old<span class="sc">}</span><span class="ss"> not found. "</span></span>
<span id="cb9-377"><a href="#cb9-377"></a>            <span class="op">+</span> <span class="st">"Only values available in database can be updated"</span></span>
<span id="cb9-378"><a href="#cb9-378"></a>        )</span>
<span id="cb9-379"><a href="#cb9-379"></a>    <span class="cf">else</span>:</span>
<span id="cb9-380"><a href="#cb9-380"></a>        stmt <span class="op">=</span> (</span>
<span id="cb9-381"><a href="#cb9-381"></a>            update(</span>
<span id="cb9-382"><a href="#cb9-382"></a>                fastapi</span>
<span id="cb9-383"><a href="#cb9-383"></a>            )</span>
<span id="cb9-384"><a href="#cb9-384"></a>            .where(</span>
<span id="cb9-385"><a href="#cb9-385"></a>                fastapi.columns.Year <span class="op">==</span> year_old,</span>
<span id="cb9-386"><a href="#cb9-386"></a>            )</span>
<span id="cb9-387"><a href="#cb9-387"></a>            .values(</span>
<span id="cb9-388"><a href="#cb9-388"></a>                Year <span class="op">=</span> year_new,</span>
<span id="cb9-389"><a href="#cb9-389"></a>            )</span>
<span id="cb9-390"><a href="#cb9-390"></a>        )</span>
<span id="cb9-391"><a href="#cb9-391"></a></span>
<span id="cb9-392"><a href="#cb9-392"></a>        connection.execute(stmt)</span>
<span id="cb9-393"><a href="#cb9-393"></a>        connection.commit()</span>
<span id="cb9-394"><a href="#cb9-394"></a>        connection.close()</span>
<span id="cb9-395"><a href="#cb9-395"></a></span>
<span id="cb9-396"><a href="#cb9-396"></a>        <span class="cf">return</span> {<span class="st">"success"</span>: <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss">; and year </span><span class="sc">{</span>year_old<span class="sc">}</span><span class="ss"> updated to year </span><span class="sc">{</span>year_new<span class="sc">}</span><span class="ss">;"</span>}</span>
<span id="cb9-397"><a href="#cb9-397"></a></span>
<span id="cb9-398"><a href="#cb9-398"></a><span class="at">@app.delete</span>(<span class="st">"/delete/</span><span class="sc">{municipality}</span><span class="st">/</span><span class="sc">{year}</span><span class="st">/</span><span class="sc">{tax}</span><span class="st">"</span>)</span>
<span id="cb9-399"><a href="#cb9-399"></a><span class="kw">def</span> delete_tax_entry(</span>
<span id="cb9-400"><a href="#cb9-400"></a>        municipality    : <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-401"><a href="#cb9-401"></a>        year            : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-402"><a href="#cb9-402"></a>        tax             : <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-403"><a href="#cb9-403"></a>    ):</span>
<span id="cb9-404"><a href="#cb9-404"></a>    <span class="co">"""</span></span>
<span id="cb9-405"><a href="#cb9-405"></a><span class="co">    Delete entry given municipality, year and income tax value</span></span>
<span id="cb9-406"><a href="#cb9-406"></a><span class="co">    """</span></span>
<span id="cb9-407"><a href="#cb9-407"></a>    in_stmt <span class="op">=</span> (</span>
<span id="cb9-408"><a href="#cb9-408"></a>        select(</span>
<span id="cb9-409"><a href="#cb9-409"></a>            fastapi</span>
<span id="cb9-410"><a href="#cb9-410"></a>        )</span>
<span id="cb9-411"><a href="#cb9-411"></a>        .where(</span>
<span id="cb9-412"><a href="#cb9-412"></a>            fastapi.columns.Municipality <span class="op">==</span> municipality,</span>
<span id="cb9-413"><a href="#cb9-413"></a>            fastapi.columns.Year <span class="op">==</span> year,</span>
<span id="cb9-414"><a href="#cb9-414"></a>        )</span>
<span id="cb9-415"><a href="#cb9-415"></a>    )</span>
<span id="cb9-416"><a href="#cb9-416"></a>    </span>
<span id="cb9-417"><a href="#cb9-417"></a>    connection <span class="op">=</span> engine.<span class="ex">connect</span>()</span>
<span id="cb9-418"><a href="#cb9-418"></a>    result <span class="op">=</span> connection.execute(in_stmt).fetchall()</span>
<span id="cb9-419"><a href="#cb9-419"></a>    </span>
<span id="cb9-420"><a href="#cb9-420"></a>    <span class="cf">if</span> <span class="kw">not</span> result:</span>
<span id="cb9-421"><a href="#cb9-421"></a>        <span class="cf">raise</span> HTTPException(</span>
<span id="cb9-422"><a href="#cb9-422"></a>            status_code<span class="op">=</span><span class="dv">404</span>, </span>
<span id="cb9-423"><a href="#cb9-423"></a>            detail <span class="op">=</span> <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss"> and year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> not found. "</span></span>
<span id="cb9-424"><a href="#cb9-424"></a>            <span class="op">+</span> <span class="st">"Only values in database can be deleted"</span>,</span>
<span id="cb9-425"><a href="#cb9-425"></a>        )</span>
<span id="cb9-426"><a href="#cb9-426"></a>    <span class="cf">else</span>:</span>
<span id="cb9-427"><a href="#cb9-427"></a>        stmt <span class="op">=</span> (</span>
<span id="cb9-428"><a href="#cb9-428"></a>            delete(</span>
<span id="cb9-429"><a href="#cb9-429"></a>                fastapi</span>
<span id="cb9-430"><a href="#cb9-430"></a>            )</span>
<span id="cb9-431"><a href="#cb9-431"></a>            .where(</span>
<span id="cb9-432"><a href="#cb9-432"></a>                fastapi.columns.Municipality <span class="op">==</span> municipality,</span>
<span id="cb9-433"><a href="#cb9-433"></a>                fastapi.columns.Year <span class="op">==</span> year,</span>
<span id="cb9-434"><a href="#cb9-434"></a>                fastapi.columns.Tax <span class="op">==</span> tax,</span>
<span id="cb9-435"><a href="#cb9-435"></a>            )</span>
<span id="cb9-436"><a href="#cb9-436"></a>        )</span>
<span id="cb9-437"><a href="#cb9-437"></a></span>
<span id="cb9-438"><a href="#cb9-438"></a>        connection.execute(stmt)</span>
<span id="cb9-439"><a href="#cb9-439"></a>        connection.commit()</span>
<span id="cb9-440"><a href="#cb9-440"></a>        connection.close()</span>
<span id="cb9-441"><a href="#cb9-441"></a></span>
<span id="cb9-442"><a href="#cb9-442"></a>        <span class="cf">return</span> {<span class="st">"success"</span>: <span class="ss">f"Item with name </span><span class="sc">{</span>municipality<span class="sc">}</span><span class="ss">; tax of </span><span class="sc">{</span>tax<span class="sc">}</span><span class="ss">; and year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss"> deleted."</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
  </div>
</footer>



</body></html>