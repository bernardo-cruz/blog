<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bernardo Freire">
<meta name="dcterms.date" content="2024-08-01">

<title>DevOps with Docker &amp; Gitlab ‚Äì Bernardo Cruz</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="DevOps with Docker &amp; Gitlab ‚Äì Bernardo Cruz">
<meta property="og:description" content="">
<meta property="og:site_name" content="Bernardo Cruz">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Bernardo Cruz</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a>
  <ul class="collapse">
  <li><a href="#requirements" id="toc-requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
  <li><a href="#choose-a-project" id="toc-choose-a-project" class="nav-link" data-scroll-target="#choose-a-project">Choose a Project</a></li>
  </ul></li>
  <li><a href="#components-of-pipeline" id="toc-components-of-pipeline" class="nav-link" data-scroll-target="#components-of-pipeline">Components of Pipeline</a>
  <ul class="collapse">
  <li><a href="#dockerfile" id="toc-dockerfile" class="nav-link" data-scroll-target="#dockerfile">Dockerfile</a></li>
  <li><a href="#docker-registry" id="toc-docker-registry" class="nav-link" data-scroll-target="#docker-registry">Docker Registry</a></li>
  <li><a href="#gitlab-cicd" id="toc-gitlab-cicd" class="nav-link" data-scroll-target="#gitlab-cicd">Gitlab CI/CD</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DevOps with Docker &amp; Gitlab</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Docker</div>
    <div class="quarto-category">Containerization</div>
    <div class="quarto-category">Deployment</div>
    <div class="quarto-category">Gitlab</div>
    <div class="quarto-category">DevOps</div>
    <div class="quarto-category">CI/CD</div>
    <div class="quarto-category">Automation</div>
    <div class="quarto-category">Github Pages</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bernardo Freire </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>My intention with this article is to provide a hands-on demonstration of what I have accomplished so far in DevOps. Rather than just discussing theory, I will show you the following:</p>
<ul>
<li>How to leverage a <code>Dockerfile</code> to create a Docker image.</li>
<li>How to push and pull the image to and from a private Docker registry and not from public <code>Docker Hub</code>.</li>
<li>How to push the output of a process to <code>GitHub</code> in order use <code>Github Pages</code> to publish a website.</li>
</ul>
<p>We are going to use <code>GitLab CI/CD</code> to automate all the steps mentioned above.</p>
<p>Please note that I am not an expert in DevOps and am still learning. I am sharing this article to show you what I have done so far and to get feedback from you. :)</p>
</section>
<section id="motivation" class="level1">
<h1>Motivation</h1>
<p>In my previous jobs, when the code was done, I only needed to push it to a repository while providing a <code>requirements.txt</code> file. The rest was handled by the DevOps team. I never had to worry about how the code was deployed to the server.</p>
<p>But now, I am working on my own projects and have to manage everything myself. I had to set up servers, deploy the code, and ensure everything is working correctly. This is why I started learning DevOps. So far I used <code>Gitlab CI/CD</code> to automate the process of building, pushing, and pulling a Docker image. For those of you who are not familiar with <code>GitLab CI/CD</code>, it is a tool that automates the process of testing and deploying code. It is essentially a pipeline that <strong>runs every time you push code to a repository</strong> and executes the steps you define in the <code>.gitlab-ci.yml</code> file. You can also leverage <code>Gitlab Runner</code> to run the pipeline on your own server/computer, and not rely on <code>GitLab</code> to run the pipeline for you.</p>
<p>When combined with <code>Docker</code>, it can be used to automate the process of building, pushing, and pulling Docker images and customizing the deployment process. Moreover, when using a private Docker registry, you can ensure that your images are secure and not publicly available.</p>
<p>Enough talking, let‚Äôs get started!</p>
<section id="requirements" class="level2">
<h2 class="anchored" data-anchor-id="requirements">Requirements</h2>
<p>In order to be able to follow along with this article, you need to have the following installed/registered:</p>
<ul class="task-list">
<li><label><input type="checkbox">Docker</label></li>
<li><label><input type="checkbox">GitLab account</label></li>
<li><label><input type="checkbox">Github account</label></li>
</ul>
<p><em>Optional:</em></p>
<ul class="task-list">
<li><label><input type="checkbox">GitLab Runner installed on your server/computer</label></li>
</ul>
<p>These are the only requirements you need to follow along with this article. Next, we will discuss the requirements for the project we are going to work on.</p>
</section>
<section id="choose-a-project" class="level2">
<h2 class="anchored" data-anchor-id="choose-a-project">Choose a Project</h2>
<p>I have chosen a simple project that I have been working on‚Äîthis blog üòú</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Think about a project that you have been working on and would like to automate the process of building and pushing. It doesn‚Äôt really matter what project you choose. The important thing is to understand the process of building, pushing, and pulling a Docker image and how to leverage GitLab CI/CD to automate the process.</p>
</div>
</div>
</div>
<p>Our plan is as follows:</p>
<p>First, we push our code to GitLab and then use GitLab CI/CD to build and push a Docker image to our private Docker registry. We will then pull the image and ‚Äúdo something‚Äù with it. In my case, I am going to render this blog using <a href="https://quarto.org/">ÃÄ<code>Quarto</code></a> and push it to GitHub. Finally, we are going to use GitHub Actions to automate the process of pushing the output of the process to GitHub Pages.</p>
</section>
</section>
<section id="components-of-pipeline" class="level1">
<h1>Components of Pipeline</h1>
<p>In the next sections, we are going to discuss the components of the pipeline we are going to build. Here, a brief overview of the components:</p>
<ul>
<li><strong>Dockerfile</strong>:&nbsp;Which ensures that the image is built correctly and reproducibly.</li>
<li><strong>GitLab CI/CD</strong>: To automate the process of building, pushing, and pulling the Docker image.</li>
<li><strong>Docker Registry</strong>:&nbsp;To store the Docker image.</li>
<li><strong>GitHub Actions</strong>: To automate the process of pushing the output of the process to GitHub Pages.</li>
</ul>
<section id="dockerfile" class="level2">
<h2 class="anchored" data-anchor-id="dockerfile">Dockerfile</h2>
<p>Again, the <code>Dockerfile</code> is a text document that contains all the commands a user could call on the command line to assemble an image. Using <code>Dockerfile</code>, we can automate the process of building a <code>Docker</code> image.</p>
<p>Here, I demonstrate how I utilized a <code>Dockerfile</code> to build a Docker image for this blog. I used <a href="https://quarto.org/"><code>Quarto</code></a> framework to render HTML&nbsp;pages. I chose to build the image from scratch, starting with the Ubuntu base image and installing all necessary dependencies along with the Quarto application.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource dockerfile number-lines code-with-copy"><code class="sourceCode dockerfile"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Base image</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">FROM</span> ubuntu:jammy</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Install the required packages</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>    bash <span class="dt">\</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>    curl <span class="dt">\</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>    git <span class="dt">\</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>    jq <span class="dt">\</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>    openssh-client <span class="dt">\</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>    ca-certificates <span class="dt">\</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>    dpkg</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co"># Install quarto  </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw">RUN</span> <span class="ex">curl</span> <span class="at">-sL</span> <span class="at">-o</span> installer.deb <span class="dt">\</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>    https://github.com/quarto-dev/quarto-cli/releases/download/v1.5.56/quarto-1.5.56-linux-amd64.deb <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="ex">dpkg</span> <span class="at">-i</span> installer.deb <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>    <span class="fu">rm</span> installer.deb</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co"># Create a directory for the app</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /app</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co"># Set the working directory</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co"># CHMOD app - give permission to the app directory</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="kw">RUN</span> <span class="fu">chmod</span> <span class="at">-R</span> 777 /app</span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co"># Copy the content of the local src directory to the working directory</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="kw">COPY</span> . .</span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co"># Make a directory for the output (empty for now)</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> ./_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We start with the base image <code>ubuntu:jammy</code>, which is a Docker image containing the Ubuntu operating system. First, we install the necessary dependencies and download the <code>Quarto</code> installer from GitHub, then proceed with its installation. Next, we create a directory for the app and set the working directory to <code>/app</code>. We copy the contents of the current directory into the <code>/app</code> directory and create an <code>_output</code> directory. This <code>_output</code> directory will store the process output, which will eventually be pushed to GitHub. Currently, <code>_output</code> is empty.</p>
</section>
<section id="docker-registry" class="level2">
<h2 class="anchored" data-anchor-id="docker-registry">Docker Registry</h2>
<p>As we decided to create a <code>private Docker registry</code> to store our <code>Docker</code> images, we use the <code>Docker registry</code> image to create a <code>private Docker registry</code> and also a convenient UI to manage the registry. The easiest way to do this is by using <code>Docker Compose</code>, which is a tool for defining and running multi-container <code>Docker</code> applications.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="at">  </span><span class="fu">registry-server</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> registry:2.8</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> registry-server</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">"5000:5000"</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> always</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./registry-data:/var/lib/registry</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="at">    </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="at">  </span><span class="fu">registry-ui</span><span class="kw">:</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> joxit/docker-registry-ui:2.5-debian</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> registry-ui</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> always</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"9000:80"</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="at">      </span><span class="fu">SINGLE_REGISTRY</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="at">      </span><span class="fu">REGISTRY_TITLE</span><span class="kw">:</span><span class="at"> Own Docker Registry UI</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="at">      </span><span class="fu">DELETE_IMAGES</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="at">      </span><span class="fu">SHOW_CONTENT_DIGEST</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="at">      </span><span class="fu">NGINX_PROXY_PASS_URL</span><span class="kw">:</span><span class="at"> http://registry-server:5000</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="at">      </span><span class="fu">SHOW_CATALOG_NB_TAGS</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="at">      </span><span class="fu">CATALOG_MIN_BRANCHES</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="at">      </span><span class="fu">CATALOG_MAX_BRANCHES</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="at">      </span><span class="fu">TAGLIST_PAGE_SIZE</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="at">      </span><span class="fu">REGISTRY_SECURED</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="at">      </span><span class="fu">CATALOG_ELEMENTS_LIMIT</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="at">      </span><span class="fu">THEME</span><span class="kw">:</span><span class="at"> dark</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First, we define the <code>services</code> that we are going to use. We define two services: <code>registry-server</code> and <code>registry-ui</code>. The <code>registry-server</code> is the <code>private Docker registry</code> that we are going to use to store the <code>Docker</code> image. The <code>registry-ui</code> is a <code>Docker</code> image that provides a UI for the <code>private Docker registry</code>. We can use the UI to see the images that are stored in the <code>private Docker registry</code>.</p>
</section>
<section id="gitlab-cicd" class="level2">
<h2 class="anchored" data-anchor-id="gitlab-cicd">Gitlab CI/CD</h2>
<p>Having a <code>Dockerfile</code> and <code>Registry</code> means we are almost ready to deploy.</p>
<p>The final step in our pipeline is to wrap everything up in a pipeline. This is where <code>Gitlab CI/CD</code> comes into play. The <code>.gitlab-ci.yml</code> file is where we define the pipeline and the steps that are going to be executed when we push code to the repository. Stages, variables and jobs are defined in the <code>.gitlab-ci.yml</code> file.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="at">  </span><span class="kw">-</span><span class="at"> build</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="at">  </span><span class="kw">-</span><span class="at"> render</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="at">  </span><span class="kw">-</span><span class="at"> deploy</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="fu">variables</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="at">  </span><span class="fu">REGISTRY_HOST</span><span class="kw">:</span><span class="at"> </span><span class="st">'&lt;host-url&gt;'</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="at">  </span><span class="fu">REGISTRY_USER</span><span class="kw">:</span><span class="at"> </span><span class="st">'&lt;host-user&gt;'</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="at">  </span><span class="fu">APP_NAME</span><span class="kw">:</span><span class="at"> </span><span class="st">'$CI_PROJECT_NAME'</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="at">  </span><span class="fu">APP_VERSION</span><span class="kw">:</span><span class="at"> </span><span class="st">'$CI_COMMIT_BRANCH'</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="at">  </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">## Build the Docker image and push it to the private Docker registry</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> build</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> docker</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="at">  </span><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> docker:27.1.1-dind</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="at">      </span><span class="fu">alias</span><span class="kw">:</span><span class="at"> docker</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="at">      </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="st">"--tls=false"</span><span class="kw">,</span><span class="st">"--insecure-registry=&lt;host-url&gt;"</span><span class="kw">]</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker build -t $REGISTRY_HOST/$REGISTRY_USER/$APP_NAME:$APP_VERSION .</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker push $REGISTRY_HOST/$REGISTRY_USER/$APP_NAME:$APP_VERSION</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="at">  </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">your_tag</span><span class="kw">]</span></span>
<span id="cb3-24"><a href="#cb3-24"></a></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">## Render the bookdown project using the previous build image</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">## content is rendered to "_output"</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="fu">render</span><span class="kw">:</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> render</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> $REGISTRY_HOST/$REGISTRY_USER/$APP_NAME:$APP_VERSION</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="at">    </span><span class="kw">-</span><span class="at"> quarto render</span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="at">  </span><span class="fu">artifacts</span><span class="kw">:</span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'_output/'</span><span class="kw">]</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="at">    </span><span class="fu">expire_in</span><span class="kw">:</span><span class="at"> 10 mins</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="at">  </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">your_tag</span><span class="kw">]</span></span>
<span id="cb3-36"><a href="#cb3-36"></a></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co"># Push the content of "_output" to github (for github pages)</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="co"># Fetch output from the previous stage</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="fu">push_output_to_github</span><span class="kw">:</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ubuntu:jammy</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="at">  </span><span class="fu">before_script</span><span class="kw">:</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="at">    </span><span class="kw">-</span><span class="at"> apt-get update &amp;&amp; apt-get install -y git</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git config --global user.email "&lt;your-email&gt;"</span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git config --global user.name "&lt;your-name&gt;"</span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git clone https://$GITHUB_TOKEN@github.com/&lt;your-name&gt;/&lt;repo-name&gt;.git</span></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git checkout main</span></span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="at">    </span><span class="kw">-</span><span class="at"> cd blog</span></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="at">    </span><span class="kw">-</span><span class="at"> rm -rf *</span></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="at">    </span><span class="kw">-</span><span class="at"> cp -r ../_output/* .</span></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git status</span></span>
<span id="cb3-53"><a href="#cb3-53"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git add .</span></span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git status</span></span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git commit -m "auto-commit for deployment"</span></span>
<span id="cb3-56"><a href="#cb3-56"></a><span class="at">    </span><span class="kw">-</span><span class="at"> git push origin main</span></span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="at">  </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb3-58"><a href="#cb3-58"></a><span class="at">    </span><span class="kw">-</span><span class="at"> render</span></span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="at">  </span><span class="fu">only</span><span class="kw">:</span></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="at">    </span><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="at">  </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">your_tag</span><span class="kw">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Variables like <code>$GITHUB_TOKEN</code> should be defined in the <code>Gitlab</code> settings. You can define them in the <code>CI/CD</code> settings of your project.</p>
</div>
</div>
</div>
<p>This YAML file defines a CI/CD pipeline with three stages: build, render, and deploy and four variables that are used in the pipeline. Let‚Äôs review the pipeline:</p>
<p>Variables:</p>
<ul>
<li>REGISTRY_HOST: URL of the Docker registry.</li>
<li>REGISTRY_USER: User for the Docker registry.</li>
<li>APP_NAME: Name of the application, derived from the CI project name.</li>
<li>APP_VERSION: Version of the application, derived from the CI commit branch.</li>
</ul>
<p>Build Stage:</p>
<ul>
<li>Uses the docker image.</li>
<li>Runs a Docker-in-Docker service.</li>
<li>Builds a Docker image and pushes it to the private Docker registry.</li>
</ul>
<p>Render Stage:</p>
<ul>
<li>Uses the Docker image built in the previous stage.</li>
<li>Runs quarto render to render the bookdown project.</li>
<li>Saves the rendered content to the _output directory as artifacts.</li>
</ul>
<p>Deploy Stage:</p>
<ul>
<li>Uses the ubuntu:jammy image.</li>
<li>Installs Git.</li>
<li>Configures Git user details.</li>
<li>Clones a GitHub repository using a token.</li>
<li>Copies the rendered content from _output to the repository.</li>
<li>Commits and pushes the changes to the main branch.</li>
<li>The file also includes a tip that variables like $GITHUB_TOKEN should be defined in the GitLab CI/CD settings.</li>
</ul>
<p>We have seen how to build a Docker image, push it to a private Docker registry, render the content, and push the output to GitHub.</p>
<p>In my case, where I would like to publish a static HTML&nbsp;website I still need to go one step further. I need enable <code>Github Actions</code> to publish a website using <code>Github Pages</code>. <code>Github Pages</code> is a static site hosting service that takes HTML, CSS, and JavaScript files straight from a repository on <code>Github</code> and publishes a website - for more information on how to enable <code>Github Pages</code> for your repository, please refer to the <a href="https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site">official documentation</a>.</p>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>In this article, we discussed how to automate the process of building, pushing, and pulling a Docker image using GitLab CI/CD. We also discussed how to use a private Docker registry to store the Docker image and how to leverage GitHub Pages to publish the output of the process. By following these steps, you can automate the deployment process for your projects, making it easier to manage and deploy your applications. This not only saves time but also reduces the chances of human error.</p>
<p>In a next article, I will discuss how to use <code>GitLab Runner</code> to run the pipeline on your own server/computer, and not rely on <code>GitLab</code> to run the pipeline for you and as well the specifics of the <code>Docker Registry</code> and the UI of <code>Gitlab</code>.</p>
<p>Remember, the key to successful DevOps is continuous learning and improvement. As you gain more experience, you can refine and optimize your pipeline to better suit your needs.</p>
<p>Thank you for following along, and I hope you found this guide helpful. If you have any feedback or questions, feel free to reach out!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>